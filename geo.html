<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <style>
        .green {
            color: green;
        }
        .red {
            color: red;
        }
        .blue {
            color: blue;
        }
        #map {
            width: 500px;
            height: 500px;
        }
    </style>
</head>

<body>
    <div id="compat"></div>
    <div id="rejected"></div>
    <div id="lat">Detecting lat...</div>
    <div id="lng">Detecting long...</div>
    <div id="map"></div>
    <script type="text/javascript">
        var state = {
            lat: 0,
            lng: 0,
            mapInit: false,
            watchId: null,
        };
        function success(pos) {
            var crd = pos.coords;
            state.lat = pos.coords.latitude;
            state.lng = pos.coords.longitude;
            buildMap();
        }
        function error(err) {
            console.warn('ERROR(' + err.code + '): ' + err.message);
        }
        function initMap() {
            state.mapInit = true;
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: state.lat, lng: state.lng},
                zoom: 20
            });
            setMap();
        }
        function setMap() {
            var marker = new google.maps.Marker({
                position: {lat: state.lat, lng: state.lng},
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                title: 'Drag to your position'
            });
            options = {
                enableHighAccuracy: false,
                maximumAge: 0
            };
            google.maps.event.addListener(marker, "dragend", function(event) {
                state.lat = event.latLng.lat();
                state.lng = event.latLng.lng();
                updatePostion();
            });
            updatePostion();
            // state.watchId = navigator.geolocation.watchPosition(success, error, options);
        }

        function updatePostion() {
            var lat = document.getElementById("lat");
            var lng = document.getElementById("lng");
            lat.innerText = state.lat;
            lng.innerText = state.lng;
            lat.classList.add("blue");
            lng.classList.add("blue");
        }

        document.addEventListener('DOMContentLoaded', function(event) {
            var el = document.getElementById("compat");
            if ("geolocation" in navigator) {
                el.textContent = "Your browser supports geolocation";
                el.classList.add("green")
            } else {
                el.textContent += "Your browser does not support geolocation";
                el.classList.add("red")
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    state.lat = position.coords.latitude;
                    state.lng = position.coords.longitude;
                    if (state.mapInit) {
                        updatePostion();
                    }
                },
                function(error) {
                    if (error.code == error.PERMISSION_DENIED) {
                        var el = document.getElementById("rejected");
                        el.innerText = "You blocked location services";
                    }
                }
            );
        })
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOQtFUTgh4poPJID4tFzHxY98EwdjrSco&callback=initMap"
    async defer></script>
</body>

</html>